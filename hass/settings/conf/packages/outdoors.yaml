---
automation:
  - alias: "Handle Local Sun Events"
    id: "handle_local_sun_events"
    trigger:
      - platform: state
        id: sunrise
        entity_id: binary_sensor.in_bed
        to: "off"
      - platform: numeric_state
        id: sunset
        entity_id: sensor.solarradiation_perceived
        below: input_number.local_sunset_brightness
      - platform: sun
        id: sunset
        event: sunset
    action:
      choose:
        - conditions:
            condition: trigger
            id: sunrise
          sequence:
            - scene: scene.sunrise
        - conditions:
            - condition: trigger
              id: sunset
            - condition: time
              after: "15:00:00"
          sequence:
            - scene: scene.sunset

group:
  outdoor_lights:
    entities:
      - switch.backyard_lights
      - switch.front_patio_light
      - switch.kitchen_patio_light
      - switch.master_patio_light
    all: true

input_number:
  local_sunset_brightness:
    name: Local Sunset Brightness
    min: 50
    max: 70
    step: 1
    unit_of_measurement: "%"
    icon: mdi:brightness-percent
