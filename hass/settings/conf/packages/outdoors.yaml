---
automation:
  - alias: "Automatically handle sunset"
    id: "automatically_handle_sunset"
    trigger:
      - platform: numeric_state
        entity_id: sensor.solarradiation_perceived
        below: input_number.local_sunset_brightness
      - platform: sun
        event: sunset
    condition:
      - condition: time
        after: "15:00:00"
      - condition: template
        value_template: >
          {{
            as_timestamp(
              state_attr("automation.handle_sunset", "last_triggered")
            ) | timestamp_custom("%-d")
            != as_timestamp(now()) | timestamp_custom("%-d")
          }}
    action:
      scene: scene.sunset

group:
  outdoor_lights:
    entities:
      - switch.backyard_lights
      - switch.front_patio_light
      - switch.kitchen_patio_light
      - switch.master_patio_light
    all: true

input_number:
  local_sunset_brightness:
    name: Local Sunset Brightness
    min: 50
    max: 70
    step: 1
    unit_of_measurement: "%"
    icon: mdi:brightness-percent
