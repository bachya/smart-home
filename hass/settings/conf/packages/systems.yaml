---
automation:
  - alias: "Forward HASS persistent notifications"
    id: "forward_hass_persistent_notifications"
    trigger:
      platform: event
      event_type: call_service
      event_data:
        domain: persistent_notification
        service: create
    action:
      service: notify.mobile_app_aarons_iphone
      data:
        title: Home Assistant Notification
        message: "üì• {{ trigger.event.data.service_data.message }}"

  - alias: "Forward healthchecks.io notifications"
    id: "forward_healthchecks_io_notifications"
    trigger:
      platform: webhook
      webhook_id: !secret webhook_healtchecks_io
    action:
      service: notify.mobile_app_aarons_iphone
      data:
        title: healthchecks.io
        message: >
          {% if trigger.json.status == "down" %}
            ‚õîÔ∏è {{ trigger.json.name }} is DOWN.
          {% else %}
            ‚úÖ {{ trigger.json.name }} is UP.
          {% endif %}

  - alias: "Notify on HACS updates"
    id: "notify_on_hacs_updates"
    trigger:
      platform: state
      entity_id: sensor.hacs
    condition:
      condition: numeric_state
      entity_id: sensor.hacs
      above: 0
    action:
      service: notify.mobile_app_aarons_iphone
      data:
        title: HACS Updates
        message: "üíø There are {{ trigger.to_state.state }} updates."

  - alias: "Notify when battery is low"
    id: "notify_when_battery_is_low"
    trigger:
      - platform: numeric_state
        entity_id:
          - sensor.basement_firefighter_battery_level
          - sensor.fiddle_leaf_fig_battery
          - sensor.front_door_lock_battery_level
          - sensor.garage_fire_door_lock_battery_level
          - sensor.kitchen_sink_sensor_battery
          - sensor.nanomote_quad_battery_level
        below: 20
        for:
          minutes: 5
      - platform: state
        entity_id:
          - binary_sensor.basement_sensor_low_battery
          - binary_sensor.guest_bedroom_sensor_low_battery
          - binary_sensor.kitchen_sensor_low_battery
          - binary_sensor.kitchen_sink_sensor_low_battery
          - binary_sensor.upstairs_hallway_sensor_low_battery
          - binary_sensor.wh65batt
        to: "on"
        for:
          minutes: 5
    action:
      service: notify.mobile_app_aarons_iphone
      data:
        title: Low Battery
        message: "üîã The battery for {{ trigger.entity_id }} should be replaced."

  - alias: "Notify when sensor goes offline"
    id: "notify_when_sensor_goes_offline"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.basement_sensor_missing
          - binary_sensor.guest_bedroom_sensor_missing
          - binary_sensor.kitchen_sensor_missing
          - binary_sensor.master_bathroom_climate_sensor_status
          - binary_sensor.master_bedroom_salt_lamp_status
          - binary_sensor.office_salt_lamp_status
          - binary_sensor.upstairs_hallway_sensor_missing
        to: "off"
        for:
          minutes: 5
    action:
      service: notify.mobile_app_aarons_iphone
      data:
        title: Device Offline
        message: "ü§î {{ trigger.entity_id }} isn't responding."

sensor:
  - platform: dnsip
    hostname: !secret base_domain_name

  - platform: filter
    name: Filtered Speedtest Download
    entity_id: sensor.speedtest_download
    filters:
      - filter: lowpass
        time_constant: 10
        precision: 2

  - platform: filter
    name: Filtered Speedtest Ping
    entity_id: sensor.speedtest_ping
    filters:
      - filter: lowpass
        time_constant: 10
        precision: 2

  - platform: filter
    name: Filtered Speedtest Upload
    entity_id: sensor.speedtest_upload
    filters:
      - filter: lowpass
        time_constant: 10
        precision: 2

  - platform: rest
    name: Healthchecks.io Ping
    resource: !secret healthchecksio_ping_url
    scan_interval:
      minutes: 5

  - platform: version
    name: HASS Available
    source: docker
    beta: true

  - platform: version
    name: HASS Installed
