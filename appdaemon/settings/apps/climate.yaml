---
thermostat_schedule:
  module: hass_apps_loader
  class: SchedyApp

  actor_type: thermostat

  expression_environment: |
    def away_mode():
      return state("input_boolean.climate_away_mode")

    def in_blackout():
      return state("input_boolean.blackout_mode") == "on"

    def hvac_mode():
      return state("climate.thermostat_mode")

  schedule_snippets:
    cooling_season:
      - x: "70 if in_blackout() else Next()"
      - v: 74
    heating_season:
      - x: "68 if in_blackout() else Next()"
      - v: 69

  rooms:
    whole_house:
      actors:
        climate.thermostat_mode:
          supports_hvac_modes: false
          max_temp: 80
          min_temp: 60

      rescheduling_delay: 0

      schedule:
        - x: "IncludeSchedule(schedule_snippets['cooling_season']) \
            if hvac_mode() == 'cool' and away_mode() == 'off' else Next()"
        - x: "IncludeSchedule(schedule_snippets['heating_season']) \
            if hvac_mode() == 'heat' and away_mode() == 'off' else Next()"

  watched_entities:
    - climate.thermostat_mode
    - input_boolean.blackout_mode
    - input_boolean.climate_away_mode
