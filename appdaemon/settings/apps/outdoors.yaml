---
outdoor_lights_schedule:
  module: hass_apps_loader
  class: SchedyApp
  constrain_input_boolean: input_boolean.outdoor_lights_schedule_automation

  actor_type: switch

  expression_environment: |
    def is_sun_up():
      return state("sun.sun") == "above_horizon"

  rooms:

    backyard:

      actors:
        switch.backyard_lights:

      rescheduling_delay: 0

      schedule:
        - v: "on"
          rules:
            - x: "Break() if is_sun_up()"
            - {start: "17:00", end: "21:30", weekdays: "1-4, 7"}
            - {start: "17:00", end: "23:00", weekdays: 5-6}
        - v: "off"

    front_and_kitchen_patios:

      actors:
        group.patio_lights:

      rescheduling_delay: 0

      schedule:
        - v: "on"
          rules:
            - x: "Skip() if is_sun_down() else Break()"
            - {start: "17:00", end: "23:00"}
        - v: "off"

  watched_entities:
    - sun.sun

kitchen_patio_light_double_tap_backyard_lights_automation:
  module: switches
  class: DoubleTapToggleSwitch
  dependencies:
    - presence_manager
  entity_ids:
    zwave_device: zwave.kitchen_patio_light
    target: switch.backyard_lights
