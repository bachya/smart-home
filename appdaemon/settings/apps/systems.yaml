---
aaron_accountability_automation:
  module: systems
  class: AaronAccountability
  dependencies:
    - aaron
    - presence_manager
    - blackout_mode
  entity_ids:
    aaron_router_tracker: device_tracker.aarons_iphone

notify_of_low_batteries_automation:
  module: systems
  class: LowBatteries
  dependencies:
    - presence_manager
  entity_ids:
    batteries_to_monitor:
      - binary_sensor.guest_bedroom_sensor_low_battery
      - binary_sensor.kitchen_sensor_low_battery
      - binary_sensor.upstairs_hallway_sensor_low_battery
      - sensor.aeotec_nanomote_quad_aaron_bedside_battery
      - sensor.fiddle_leaf_fig_battery
      - sensor.front_door_lock_battery
      - sensor.garage_fire_door_lock_battery
      - sensor.kitchen_sink_sensor_battery
  properties:
    battery_level_threshold: 20
    notification_interval: 900
  state_changes:
    - disable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "off"
    - disable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "off"
    - disable:
        event: PROXIMITY_CHANGE
        event_data:
          old: home
      enable:
        event: PROXIMITY_CHANGE
        event_data:
          new: home

notify_media_center_left_on_automation:
  module: systems
  class: LeftInState
  dependencies:
    - presence_manager
  entity_ids:
    entity_id: switch.media_center
  properties:
    duration: 43200
    notification_target:
      - "person:Aaron"
      - "person:Britt"
    state: "on"
  state_changes:
    - disable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "off"
    - disable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "off"

notify_pi_hole_turned_off_automation:
  module: systems
  class: LeftInState
  dependencies:
    - presence_manager
  entity_ids:
    entity_id: switch.pi_hole_switch
  properties:
    duration: 300
    notification_target:
      - "slack:@aaron"
    state: "off"
  state_changes:
    - disable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "off"

notify_ps4_left_on_automation:
  module: systems
  class: LeftInState
  dependencies:
    - presence_manager
  entity_ids:
    entity_id: media_player.playstation_4
  properties:
    duration: 43200
    notification_target:
      - "person:Aaron"
      - "person:Britt"
    state: "idle"
  state_changes:
    - disable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "off"
    - disable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "off"

notify_zwave_offline_automation:
  module: systems
  class: NotifyOnStateChange
  dependencies:
    - presence_manager
  entity_ids:
    entity_id:
      - zwave.aeotec_zw090_z_stick_gen5_us
      - zwave.backyard_lights
      - zwave.dishwasher
      - zwave.fireplace
      - zwave.front_door
      - zwave.front_patio_light
      - zwave.garage_door
      - zwave.garage_lights
      - zwave.kitchen_patio_light
      - zwave.master_bathroom_fan
      - zwave.master_toilet_fan
      - zwave.powder_room_fan
      - zwave.thermostat
  properties:
    duration: 60
    notification_target:
      - "person:Aaron"
    old_state: "ready"
  state_changes:
    - disable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: vacation_mode
          state: "off"
    - disable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "on"
      enable:
        event: MODE_CHANGE
        event_data:
          name: blackout_mode
          state: "off"

pi_hole_switch:
  module: systems
  class: PiHoleSwitch
  entity_ids:
    pi_hole_active_sensor: sensor.pi_hole_active
  properties:
    pi_hole_api_key: !secret pihole_api_key
    pi_hole_hosts:
      - "172.16.10.137:8080"
      - "172.16.10.20:8080"
      - "172.16.10.24:8080"
    pi_hole_off_event: PI_HOLE_OFF
    pi_hole_on_event: PI_HOLE_ON

start_homekit_on_zwave_ready_automation:
  module: systems
  class: StartHomeKitOnZwaveReady
  entity_ids:
    to_exclude:
      - zwave.aeotec_nanomote_quad_aaron_bedside
