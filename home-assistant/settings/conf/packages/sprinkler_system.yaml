---
automation:
  - alias: "Reset RainMachine Zone: Flower Box"
    trigger:
      platform: state
      entity_id: switch.flower_box
      to: "off"
    action:
      service: input_number.set_value
      data:
        entity_id: input_number.flower_box_zone_timer
        value: 0

  - alias: "Start RainMachine Zone: Flower Box"
    trigger:
      platform: state
      entity_id: input_number.flower_box_zone_timer
    condition:
      condition: template
      value_template: >
        {{ states('input_number.flower_box_zone_timer') | int != 0 }}
    action:
      - service: rainmachine.stop_zone
        data:
          zone_id: 2
      - service: rainmachine.start_zone
        data_template:
          zone_id: 2
          zone_run_time: >
            {{ states("input_number.flower_box_zone_timer") | int * 60 }}

  - alias: "Stop RainMachine Zone: Flower Box"
    trigger:
      platform: state
      entity_id: input_number.flower_box_zone_timer
    condition:
      condition: template
      value_template: >
        {{ states('input_number.flower_box_zone_timer') | int == 0 }}
    action:
      service: rainmachine.stop_zone
      data:
        zone_id: 2

  - alias: "Reset RainMachine Zone: Landscaping"
    trigger:
      platform: state
      entity_id: switch.landscaping
      to: "off"
    action:
      service: input_number.set_value
      data:
        entity_id: input_number.landscaping_zone_timer
        value: 0

  - alias: "Start RainMachine Zone: Landscaping"
    trigger:
      platform: state
      entity_id: input_number.landscaping_zone_timer
    condition:
      condition: template
      value_template: >
        {{ states('input_number.landscaping_zone_timer') | int != 0 }}
    action:
      - service: rainmachine.stop_zone
        data:
          zone_id: 1
      - service: rainmachine.start_zone
        data_template:
          zone_id: 1
          zone_run_time: >
            {{ states("input_number.landscaping_zone_timer") | int * 60 }}

  - alias: "Stop RainMachine Zone: Landscaping"
    trigger:
      platform: state
      entity_id: input_number.landscaping_zone_timer
    condition:
      condition: template
      value_template: >
        {{ states('input_number.flower_box_zone_timer') | int == 0 }}
    action:
      service: rainmachine.stop_zone
      data:
        zone_id: 2

input_number:
  flower_box_zone_timer:
    name: Flower Box Timer
    initial: 0
    min: 0
    max: 60
    step: 5
    unit_of_measurement: minutes
    icon: mdi:timer

  landscaping_zone_timer:
    name: Landscaping Timer
    initial: 0
    min: 0
    max: 60
    step: 5
    unit_of_measurement: minutes
    icon: mdi:timer

rainmachine:
  controllers:
    - ip_address: rainmachine.phil.iot
      password: !secret rainmachine_password
