---
automation:
  - alias: Cancel landscaping sleep timer
    trigger:
      - platform: numeric_state
        entity_id: input_number.landscaping_timer
        below: 1
      - platform: state
        entity_id: switch.landscaping
        to: "off"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.landscaping_timer
          value: 0
      - service: rainmachine.stop_zone
        data:
          zone_id: 1
      - service: timer.cancel
        data:
          entity_id: timer.landscaping_timer

  - alias: Set landscaping sleep timer
    trigger:
      platform: state
      entity_id: input_number.landscaping_timer
    action:
      - service: rainmachine.stop_zone
        data:
          zone_id: 1
      - service: rainmachine.start_zone
        data_template:
          zone_id: 1
          zone_run_time: >
            {{ states("input_number.landscaping_timer") | int * 60 }}
      - service: timer.start
        data_template:
          entity_id: timer.landscaping_timer
          duration: >
            {{ states("input_number.landscaping_timer") | int * 60 }}

  - alias: Cancel flower box sleep timer
    trigger:
      - platform: numeric_state
        entity_id: input_number.flower_box_timer
        below: 1
      - platform: state
        entity_id: switch.flower_box
        to: "off"
    action:
      - service: input_number.set_value
        data:
          entity_id: input_number.flower_box_timer
          value: 0
      - service: rainmachine.stop_zone
        data:
          zone_id: 2
      - service: timer.cancel
        data:
          entity_id: timer.flower_box_timer

  - alias: Set flower box sleep timer
    trigger:
      platform: state
      entity_id: input_number.flower_box_timer
    action:
      - service: rainmachine.stop_zone
        data:
          zone_id: 2
      - service: rainmachine.start_zone
        data_template:
          zone_id: 2
          zone_run_time: >
            {{ states("input_number.flower_box_timer") | int * 60 }}
      - service: timer.start
        data_template:
          entity_id: timer.flower_box_timer
          duration: >
            {{ states("input_number.flower_box_timer") | int * 60 }}

input_number:
  flower_box_timer:
    name: Flower Box Timer
    initial: 0
    min: 0
    max: 60
    step: 5
    unit_of_measurement: minutes
    icon: mdi:timer
  landscaping_timer:
    name: Landscaping Timer
    initial: 0
    min: 0
    max: 60
    step: 5
    unit_of_measurement: minutes
    icon: mdi:timer

rainmachine:
  controllers:
    - ip_address: rainmachine.phil.iot
      password: !secret rainmachine_password

timer:
  flower_box_timer:
    name: Sleep Timer Remaining
  landscaping_timer:
    name: Sleep Timer Remaining
