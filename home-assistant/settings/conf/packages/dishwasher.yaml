---
alert:
  dishwasher_clean:
    name: 🍽 The dishwasher is clean and can be emptied.
    done_message: 🍽 The dishwashe rhas been emptied.
    title: Dishwasher is Clean
    entity_id: binary_sensor.dishwasher_clean_and_home
    state: "on"
    repeat:
      - 15
      - 60
    skip_first: true
    notifiers:
      - mobile_app_aarons_iphone
      - mobile_app_brittany_bachs_iphone

automation:
  - alias: 'Set dishwasher state to "Running"'
    trigger:
      platform: numeric_state
      entity_id: sensor.dishwasher_power
      above: 9
    action:
      service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Running

  - alias: 'Set dishwasher state to "Drying"'
    trigger:
      platform: numeric_state
      entity_id: sensor.dishwasher_power
      below: 4
    condition:
      condition: state
      entity_id: input_select.dishwasher_status
      state: Running
    action:
      service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Drying

  - alias: 'Set dishwasher state to "Clean"'
    trigger:
      platform: numeric_state
      entity_id: sensor.dishwasher_power
      below: 1
    condition:
      condition: state
      entity_id: input_select.dishwasher_status
      state: Drying
    action:
      service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Clean

binary_sensor:
  - platform: template
    sensors:
      dishwasher_clean_and_home:
        value_template: >-
          {{ states("input_select.dishwasher_status") == "Clean" and
          states("sensor.proximity_zone") == "Home" }}

input_select:
  dishwasher_status:
    name: Status
    options:
      - Dirty
      - Running
      - Drying
      - Clean

script:
  empty_dishwasher:
    sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Dirty
