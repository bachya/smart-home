---
ambient_station:
  api_key: !secret pws_api_key
  app_key: !secret pws_app_key

automation:
  - alias: "Handle backyard lights via double-tapping the kitchen patio light"
    trigger:
      - platform: event
        event_type: zwave.node_event
        event_data:
          entity_id: zwave.kitchen_patio_light
          basic_level: 0
      - platform: event
        event_type: zwave.node_event
        event_data:
          entity_id: zwave.kitchen_patio_light
          basic_level: 255
    action:
      choose:
        - conditions:
            condition: template
            value_template: "{{ trigger.event.data.basic_level == 0 }}"
          sequence:
            - service: switch.turn_off
              entity_id: switch.backyard_lights
        - conditions:
            condition: template
            value_template: "{{ trigger.event.data.basic_level == 255 }}"
          sequence:
            - service: switch.turn_on
              entity_id: switch.backyard_lights

  - alias: "Backyard lights schedule"
    trigger:
      - platform: time
        at: "21:30:00"
      - platform: time
        at: "23:00:00"
      - platform: sun
        event: sunset
    condition:
    action:
      choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.workday_tomorrow
              state: "on"
            - condition: time
              after: "21:30:00"
          sequence:
            - service: switch.turn_off
              entity_id: switch.backyard_lights
        - conditions:
            - condition: state
              entity_id: binary_sensor.workday_tomorrow
              state: "off"
            - condition: time
              after: "23:00:00"
          sequence:
            - service: switch.turn_off
              entity_id: switch.backyard_lights
      default:
        - service: switch.turn_on
          entity_id: switch.backyard_lights

  - alias: "Backyard lights schedule"
    trigger:
      - platform: time
        at: "23:00:00"
      - platform: sun
        event: sunset
    condition:
    action:
      choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.workday_tomorrow
              state: "on"
            - condition: time
              after: "23:00:00"
          sequence:
            - service: switch.turn_off
              entity_id: group.patio_lights
      default:
        - service: switch.turn_on
          entity_id: group.patio_lights

group:
  outdoor_lights:
    entities:
      - switch.backyard_lights
      - switch.front_patio_light
      - switch.kitchen_patio_light

  patio_lights:
    entities:
      - switch.front_patio_light
      - switch.kitchen_patio_light

input_boolean:
  lightning_detected_automation:
    icon: mdi:flash
    name: Notify when lightning detected
  outdoor_lights_schedule_automation:
    icon: mdi:lightbulb
    name: Automatic schedule
